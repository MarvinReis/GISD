}
}
# Output Postcode Data
PLZ <- load("Data/SHP/GEM_Zipcode_Intersections_2015.RData") %>%
as.tibble() # AGS/Postcode-Intersections-Dataset in sf format
# Output Postcode Data
PLZ <- load("Data/SHP/GEM_Zipcode_Intersections_2015.RData") %>%
as_tibble() # AGS/Postcode-Intersections-Dataset in sf format
View(PLZ)
?load
View(PLZ.df)
# Output Postcode Data
PLZ <- load("Data/SHP/GEM_Zipcode_Intersections_2015.RData", ex <- new.env())
View(ex)
# Output Postcode Data
PLZ <- get(load("Data/SHP/GEM_Zipcode_Intersections_2015.RData"))
View(PLZ)
PLZ <- ls(PLZ.df)
View(PLZ.df)
class(PLZ.df)
PLZ <- PLZ.df %>% ungroup()
View(PLZ)
View(Impdata.imputed)
PLZ.df <- PLZ.df %>%
mutate(PLZ5 = case_when(AGS == 03159009 ~ 37127),
PLZ4 = case_when(AGS == 03159009 ~ 3712),
PLZ3 = case_when(AGS == 03159009 ~ 371),
PLZ2 = case_when(AGS == 03159009 ~ 37),
PLZ1 = case_when(AGS == 03159009 ~ 3))
PLZ <- PLZ %>%
mutate(PLZ5 = case_when(AGS == 03159009 ~ 37127),
PLZ4 = case_when(AGS == 03159009 ~ 3712),
PLZ3 = case_when(AGS == 03159009 ~ 371),
PLZ2 = case_when(AGS == 03159009 ~ 37),
PLZ1 = case_when(AGS == 03159009 ~ 3))
PLZ <- PLZ %>%
mutate(AGS = case_when(GEN == "Dransfeld" ~ 03159009
GEN == "Hattorf am Harz" ~ 03159018),
PLZ <- PLZ %>%
mutate(AGS = case_when(GEN == "Dransfeld" ~ 03159009,
GEN == "Hattorf am Harz" ~ 03159018),
PLZ5 = case_when(AGS == 03159009 ~ 37127),
PLZ4 = case_when(AGS == 03159009 ~ 3712),
PLZ3 = case_when(AGS == 03159009 ~ 371),
PLZ2 = case_when(AGS == 03159009 ~ 37),
PLZ1 = case_when(AGS == 03159009 ~ 3))
# Output Postcode Data
get(load("Data/SHP/GEM_Zipcode_Intersections_2015.RData"))
# Output Postcode Data
get(load("Data/SHP/GEM_Zipcode_Intersections_2015.RData"))
# Output Postcode Data
load("Data/SHP/GEM_Zipcode_Intersections_2015.RData")
PLZ <- PLZ.df %>%
ungroup()
PLZ <- PLZ %>%
mutate(AGS = case_when(GEN == Dransfeld ~ 03159009,
GEN == Hattorf am Harz ~ 03159018),
PLZ <- PLZ %>%
mutate(AGS = ifelse(GEN == "Dransfeld", 03159009, AGS),
PLZ5 = case_when(AGS == 03159009 ~ 37127),
PLZ4 = case_when(AGS == 03159009 ~ 3712),
PLZ3 = case_when(AGS == 03159009 ~ 371),
PLZ2 = case_when(AGS == 03159009 ~ 37),
PLZ1 = case_when(AGS == 03159009 ~ 3))
# Output Postcode Data
load("Data/SHP/GEM_Zipcode_Intersections_2015.RData")
PLZ <- PLZ.df %>%
ungroup()
PLZ <- PLZ %>%
mutate(AGS = ifelse(GEN == "Dransfeld", 03159009, AGS),
PLZ5 = case_when(AGS == 03159009 ~ 37127),
PLZ4 = case_when(AGS == 03159009 ~ 3712),
PLZ3 = case_when(AGS == 03159009 ~ 371),
PLZ2 = case_when(AGS == 03159009 ~ 37),
PLZ1 = case_when(AGS == 03159009 ~ 3))
PLZ <- PLZ %>%
mutate(AGS = ifelse(GEN == "Dransfeld", 03159009, AGS),
PLZ5 = ifelse(AGS == 03159009, 37127,PLZ5),
PLZ4 = ifelse(AGS == 03159009, 3712, PLZ4),
PLZ3 = ifelse(AGS == 03159009, 371, PLZ3),
PLZ2 = ifelse(AGS == 03159009, 37, PLZ2),
PLZ1 = ifelse(AGS == 03159009, 3, PLZ1))
# Output Postcode Data
load("Data/SHP/GEM_Zipcode_Intersections_2015.RData")
PLZ <- PLZ.df %>%
ungroup()
PLZ <- PLZ %>%
mutate(AGS = ifelse(GEN == "Dransfeld", 03159009, AGS),
PLZ5 = ifelse(AGS == 03159009, 37127,PLZ5),
PLZ4 = ifelse(AGS == 03159009, 3712, PLZ4),
PLZ3 = ifelse(AGS == 03159009, 371, PLZ3),
PLZ2 = ifelse(AGS == 03159009, 37, PLZ2),
PLZ1 = ifelse(AGS == 03159009, 3, PLZ1))
# Output Postcode Data
load("Data/SHP/GEM_Zipcode_Intersections_2015.RData")
PLZ <- PLZ.df %>%
ungroup()
PLZ <- PLZ %>%
mutate(AGS = ifelse(GEN == "Dransfeld", 03159009, AGS),
AGS = ifelse(GEN == "Hattorf", 03159018, AGS),
PLZ5 = ifelse(AGS == 03159009, 37127,PLZ5),
PLZ5 = ifelse(AGS == 03159018, 37197,PLZ5),
PLZ4 = ifelse(AGS == 03159009, 3712, PLZ4),
PLZ4 = ifelse(AGS == 03159018, 3719, PLZ4),
PLZ3 = ifelse(AGS == 03159009, 371, PLZ3),
PLZ3 = ifelse(AGS == 03159018, 371, PLZ3),
PLZ2 = ifelse(AGS == 03159009, 37, PLZ2),
PLZ2 = ifelse(AGS == 03159018, 37, PLZ2),
PLZ1 = ifelse(AGS == 03159009, 3, PLZ1),
PLZ1 = ifelse(AGS == 03159018, 3, PLZ1))
# Output Postcode Data
load("Data/SHP/GEM_Zipcode_Intersections_2015.RData")
PLZ <- PLZ.df %>%
ungroup()
class(plz$AGS)
class(PLZ$AGS)
class(PLZ$PLZ5)
PLZ <- PLZ %>%
mutate(AGS = ifelse(GEN == "Dransfeld", as.factor(03159009), AGS),
AGS = ifelse(GEN == "Hattorf", as.factor(03159018), AGS),
PLZ5 = ifelse(AGS == 03159009, 37127, PLZ5),
PLZ5 = ifelse(AGS == 03159018, 37197,PLZ5),
PLZ4 = ifelse(AGS == 03159009, 3712, PLZ4),
PLZ4 = ifelse(AGS == 03159018, 3719, PLZ4),
PLZ3 = ifelse(AGS == 03159009, 371, PLZ3),
PLZ3 = ifelse(AGS == 03159018, 371, PLZ3),
PLZ2 = ifelse(AGS == 03159009, 37, PLZ2),
PLZ2 = ifelse(AGS == 03159018, 37, PLZ2),
PLZ1 = ifelse(AGS == 03159009, 3, PLZ1),
PLZ1 = ifelse(AGS == 03159018, 3, PLZ1))
# Output Postcode Data
load("Data/SHP/GEM_Zipcode_Intersections_2015.RData")
PLZ <- PLZ.df %>%
ungroup()
PLZ <- PLZ %>%
mutate(AGS = ifelse(GEN == "Dransfeld", 03159009, as.numeric(AGS)),
AGS = ifelse(GEN == "Hattorf", 03159018, as.numeric(AGS)),
PLZ5 = ifelse(AGS == 03159009, 37127, PLZ5),
PLZ5 = ifelse(AGS == 03159018, 37197,PLZ5),
PLZ4 = ifelse(AGS == 03159009, 3712, PLZ4),
PLZ4 = ifelse(AGS == 03159018, 3719, PLZ4),
PLZ3 = ifelse(AGS == 03159009, 371, PLZ3),
PLZ3 = ifelse(AGS == 03159018, 371, PLZ3),
PLZ2 = ifelse(AGS == 03159009, 37, PLZ2),
PLZ2 = ifelse(AGS == 03159018, 37, PLZ2),
PLZ1 = ifelse(AGS == 03159009, 3, PLZ1),
PLZ1 = ifelse(AGS == 03159018, 3, PLZ1))
# Output Postcode Data
load("Data/SHP/GEM_Zipcode_Intersections_2015.RData")
PLZ <- PLZ.df %>%
ungroup()
PLZ <- PLZ %>%
mutate(AGS = ifelse(GEN == "Dransfeld", 03159009, as.factor(AGS)),
AGS = ifelse(GEN == "Hattorf", 03159018, as.factor(AGS)),
PLZ5 = ifelse(AGS == 03159009, 37127, PLZ5),
PLZ5 = ifelse(AGS == 03159018, 37197,PLZ5),
PLZ4 = ifelse(AGS == 03159009, 3712, PLZ4),
PLZ4 = ifelse(AGS == 03159018, 3719, PLZ4),
PLZ3 = ifelse(AGS == 03159009, 371, PLZ3),
PLZ3 = ifelse(AGS == 03159018, 371, PLZ3),
PLZ2 = ifelse(AGS == 03159009, 37, PLZ2),
PLZ2 = ifelse(AGS == 03159018, 37, PLZ2),
PLZ1 = ifelse(AGS == 03159009, 3, PLZ1),
PLZ1 = ifelse(AGS == 03159018, 3, PLZ1))
# Output Postcode Data
load("Data/SHP/GEM_Zipcode_Intersections_2015.RData")
PLZ <- PLZ.df %>%
ungroup()
PLZ <- PLZ %>%
mutate(AGS = ifelse(GEN == "Dransfeld", 03159009, as.numeric(as.character(AGS))),
AGS = ifelse(GEN == "Hattorf", 03159018, as.numeric(as.character(AGS))),
PLZ5 = ifelse(AGS == 03159009, 37127, PLZ5),
PLZ5 = ifelse(AGS == 03159018, 37197,PLZ5),
PLZ4 = ifelse(AGS == 03159009, 3712, PLZ4),
PLZ4 = ifelse(AGS == 03159018, 3719, PLZ4),
PLZ3 = ifelse(AGS == 03159009, 371, PLZ3),
PLZ3 = ifelse(AGS == 03159018, 371, PLZ3),
PLZ2 = ifelse(AGS == 03159009, 37, PLZ2),
PLZ2 = ifelse(AGS == 03159018, 37, PLZ2),
PLZ1 = ifelse(AGS == 03159009, 3, PLZ1),
PLZ1 = ifelse(AGS == 03159018, 3, PLZ1))
# Output Postcode Data
load("Data/SHP/GEM_Zipcode_Intersections_2015.RData")
PLZ <- PLZ.df %>%
ungroup()
PLZ <- PLZ %>%
mutate(AGS = ifelse(GEN == "Dransfeld", as.numeric(as.character(03159009)), as.numeric(as.character(AGS))),
AGS = ifelse(GEN == "Hattorf", as.numeric(as.character(03159018)), as.numeric(as.character(AGS))),
PLZ5 = ifelse(AGS == 03159009, 37127, PLZ5),
PLZ5 = ifelse(AGS == 03159018, 37197,PLZ5),
PLZ4 = ifelse(AGS == 03159009, 3712, PLZ4),
PLZ4 = ifelse(AGS == 03159018, 3719, PLZ4),
PLZ3 = ifelse(AGS == 03159009, 371, PLZ3),
PLZ3 = ifelse(AGS == 03159018, 371, PLZ3),
PLZ2 = ifelse(AGS == 03159009, 37, PLZ2),
PLZ2 = ifelse(AGS == 03159018, 37, PLZ2),
PLZ1 = ifelse(AGS == 03159009, 3, PLZ1),
PLZ1 = ifelse(AGS == 03159018, 3, PLZ1))
PLZ <- PLZ.df %>%
ungroup()
PLZ <- PLZ %>%
mutate(AGS = ifelse(GEN == "Dransfeld", as.numeric(as.character(03159009)), as.numeric(as.character(AGS))),
AGS = ifelse(GEN == "Hattorf", as.numeric(as.character(03159018)), as.numeric(as.character(AGS))),
PLZ5 = ifelse(AGS == 03159009, 37127, PLZ5),
PLZ5 = ifelse(AGS == 03159018, 37197,PLZ5),
PLZ5 = ifelse(AGS == 15090070, 39628,PLZ5),
PLZ4 = ifelse(AGS == 03159009, 3712, PLZ4),
PLZ4 = ifelse(AGS == 03159018, 3719, PLZ4),
PLZ4 = ifelse(AGS == 15090070, 3962, PLZ4),
PLZ3 = ifelse(AGS == 03159009, 371, PLZ3),
PLZ3 = ifelse(AGS == 03159018, 371, PLZ3),
PLZ3 = ifelse(AGS == 15090070, 396, PLZ3),
PLZ2 = ifelse(AGS == 03159009, 37, PLZ2),
PLZ2 = ifelse(AGS == 03159018, 37, PLZ2),
PLZ2 = ifelse(AGS == 15090070, 39, PLZ2),
PLZ1 = ifelse(AGS == 03159009, 3, PLZ1),
PLZ1 = ifelse(AGS == 03159018, 3, PLZ1)
PLZ1 = ifelse(AGS == 15090070, 3, PLZ1))
PLZ <- PLZ %>%
mutate(AGS = ifelse(GEN == "Dransfeld", as.numeric(as.character(03159009)), as.numeric(as.character(AGS))),
AGS = ifelse(GEN == "Hattorf", as.numeric(as.character(03159018)), as.numeric(as.character(AGS))),
PLZ5 = ifelse(AGS == 03159009, 37127, PLZ5),
PLZ5 = ifelse(AGS == 03159018, 37197,PLZ5),
PLZ5 = ifelse(AGS == 15090070, 39628,PLZ5),
PLZ4 = ifelse(AGS == 03159009, 3712, PLZ4),
PLZ4 = ifelse(AGS == 03159018, 3719, PLZ4),
PLZ4 = ifelse(AGS == 15090070, 3962, PLZ4),
PLZ3 = ifelse(AGS == 03159009, 371, PLZ3),
PLZ3 = ifelse(AGS == 03159018, 371, PLZ3),
PLZ3 = ifelse(AGS == 15090070, 396, PLZ3),
PLZ2 = ifelse(AGS == 03159009, 37, PLZ2),
PLZ2 = ifelse(AGS == 03159018, 37, PLZ2),
PLZ2 = ifelse(AGS == 15090070, 39, PLZ2),
PLZ1 = ifelse(AGS == 03159009, 3, PLZ1),
PLZ1 = ifelse(AGS == 03159018, 3, PLZ1),
PLZ1 = ifelse(AGS == 15090070, 3, PLZ1))
?add_row
PLZ <- PLZ %>%
mutate(AGS = ifelse(GEN == "Dransfeld", as.numeric(as.character(03159009)), as.numeric(as.character(AGS))),
AGS = ifelse(GEN == "Hattorf", as.numeric(as.character(03159018)), as.numeric(as.character(AGS)))) %>%
add_row(AGS = as.numeric(as.character(6412000)), GEN = "Frankfurt am Main", EWZ = 732688, EW_Area = 0) %>%
mutate(PLZ5 = ifelse(AGS == 03159009, 37127, PLZ5),
PLZ5 = ifelse(AGS == 03159018, 37197,PLZ5),
PLZ5 = ifelse(AGS == 15090070, 39628,PLZ5),
PLZ4 = ifelse(AGS == 03159009, 3712, PLZ4),
PLZ4 = ifelse(AGS == 03159018, 3719, PLZ4),
PLZ4 = ifelse(AGS == 15090070, 3962, PLZ4),
PLZ3 = ifelse(AGS == 03159009, 371, PLZ3),
PLZ3 = ifelse(AGS == 03159018, 371, PLZ3),
PLZ3 = ifelse(AGS == 15090070, 396, PLZ3),
PLZ2 = ifelse(AGS == 03159009, 37, PLZ2),
PLZ2 = ifelse(AGS == 03159018, 37, PLZ2),
PLZ2 = ifelse(AGS == 15090070, 39, PLZ2),
PLZ1 = ifelse(AGS == 03159009, 3, PLZ1),
PLZ1 = ifelse(AGS == 03159018, 3, PLZ1),
PLZ1 = ifelse(AGS == 15090070, 3, PLZ1))
# Output Postcode Data
load("Data/SHP/GEM_Zipcode_Intersections_2015.RData")
PLZ <- PLZ.df %>%
ungroup()
PLZ <- PLZ %>%
mutate(AGS = ifelse(GEN == "Dransfeld", as.numeric(as.character(03159009)), as.numeric(as.character(AGS))),
AGS = ifelse(GEN == "Hattorf", as.numeric(as.character(03159018)), as.numeric(as.character(AGS)))) %>%
add_row(AGS = as.numeric(as.character(6412000)), GEN = "Frankfurt am Main", EWZ = 732688, EW_Area = 0,
PLZ5 = 60312,
PLZ4 = 6031,
PLZ3 = 603,
PLZ2 = 60,
PLZ1 = 6) %>%
mutate(PLZ5 = ifelse(AGS == 03159009, 37127, PLZ5),
PLZ5 = ifelse(AGS == 03159018, 37197,PLZ5),
PLZ5 = ifelse(AGS == 15090070, 39628,PLZ5),
PLZ4 = ifelse(AGS == 03159009, 3712, PLZ4),
PLZ4 = ifelse(AGS == 03159018, 3719, PLZ4),
PLZ4 = ifelse(AGS == 15090070, 3962, PLZ4),
PLZ3 = ifelse(AGS == 03159009, 371, PLZ3),
PLZ3 = ifelse(AGS == 03159018, 371, PLZ3),
PLZ3 = ifelse(AGS == 15090070, 396, PLZ3),
PLZ2 = ifelse(AGS == 03159009, 37, PLZ2),
PLZ2 = ifelse(AGS == 03159018, 37, PLZ2),
PLZ2 = ifelse(AGS == 15090070, 39, PLZ2),
PLZ1 = ifelse(AGS == 03159009, 3, PLZ1),
PLZ1 = ifelse(AGS == 03159018, 3, PLZ1),
PLZ1 = ifelse(AGS == 15090070, 3, PLZ1))
View(PLZ)
# Output Postcode Data
load("Data/SHP/GEM_Zipcode_Intersections_2015.RData")
PLZ <- PLZ.df %>%
ungroup()
PLZ <- PLZ %>%
mutate(AGS = ifelse(GEN == "Dransfeld", as.numeric(as.character(03159009)), as.numeric(as.character(AGS))),
AGS = ifelse(GEN == "Hattorf", as.numeric(as.character(03159018)), as.numeric(as.character(AGS))),
AGS = ifelse(GEN == "Göttingen", as.numeric(as.character(03159016)), as.numeric(as.character(AGS)))) %>%
add_row(AGS = as.numeric(as.character(6412000)), GEN = "Frankfurt am Main", EWZ = 732688, EW_Area = 0,
PLZ5 = 60312,
PLZ4 = 6031,
PLZ3 = 603,
PLZ2 = 60,
PLZ1 = 6) %>%
add_row(AGS = as.numeric(as.character(16070029)), GEN = "Ilmenau", EWZ = 26153, EW_Area = 7028,
PLZ5 = 98694,
PLZ4 = 9869,
PLZ3 = 986,
PLZ2 = 98,
PLZ1 = 9) %>%
add_row(AGS = as.numeric(as.character(16070057)), GEN = "Geratal", EWZ = 4523, EW_Area = 4523,
PLZ5 = 99331,
PLZ4 = 9933,
PLZ3 = 993,
PLZ2 = 99,
PLZ1 = 9) %>%
mutate(PLZ5 = ifelse(AGS == 03159009, 37127, PLZ5),
PLZ5 = ifelse(AGS == 03159018, 37197,PLZ5),
PLZ5 = ifelse(AGS == 15090070, 39628,PLZ5),
PLZ4 = ifelse(AGS == 03159009, 3712, PLZ4),
PLZ4 = ifelse(AGS == 03159018, 3719, PLZ4),
PLZ4 = ifelse(AGS == 15090070, 3962, PLZ4),
PLZ3 = ifelse(AGS == 03159009, 371, PLZ3),
PLZ3 = ifelse(AGS == 03159018, 371, PLZ3),
PLZ3 = ifelse(AGS == 15090070, 396, PLZ3),
PLZ2 = ifelse(AGS == 03159009, 37, PLZ2),
PLZ2 = ifelse(AGS == 03159018, 37, PLZ2),
PLZ2 = ifelse(AGS == 15090070, 39, PLZ2),
PLZ1 = ifelse(AGS == 03159009, 3, PLZ1),
PLZ1 = ifelse(AGS == 03159018, 3, PLZ1),
PLZ1 = ifelse(AGS == 15090070, 3, PLZ1))
# Output Postcode Data
load("Data/SHP/GEM_Zipcode_Intersections_2015.RData")
PLZ <- PLZ.df %>%
ungroup()
PLZ <- PLZ %>%
mutate(AGS = ifelse(GEN == "Dransfeld", as.numeric(as.character(03159009)), as.numeric(as.character(AGS))),
AGS = ifelse(GEN == "Hattorf", as.numeric(as.character(03159018)), as.numeric(as.character(AGS))),
AGS = ifelse(GEN == "Göttingen", as.numeric(as.character(03159016)), as.numeric(as.character(AGS)))) %>%
add_row(AGS = as.numeric(as.character(6412000)), GEN = "Frankfurt am Main", EWZ = 732688, EW_Area = 0,
PLZ5 = 60312,
PLZ4 = 6031,
PLZ3 = 603,
PLZ2 = 60,
PLZ1 = 6) %>%
add_row(AGS = as.numeric(as.character(16070029)), GEN = "Ilmenau", EWZ = 26153, EW_Area = 7028,
PLZ5 = 98694,
PLZ4 = 9869,
PLZ3 = 986,
PLZ2 = 98,
PLZ1 = 9) %>%
add_row(AGS = as.numeric(as.character(16070057)), GEN = "Geratal", EWZ = 4523, EW_Area = 4523,
PLZ5 = 99331,
PLZ4 = 9933,
PLZ3 = 993,
PLZ2 = 99,
PLZ1 = 9) %>%
mutate(PLZ5 = ifelse(AGS == 03159009, 37127, PLZ5),
PLZ5 = ifelse(AGS == 03159018, 37197,PLZ5),
PLZ5 = ifelse(AGS == 15090070, 39628,PLZ5),
PLZ4 = ifelse(AGS == 03159009, 3712, PLZ4),
PLZ4 = ifelse(AGS == 03159018, 3719, PLZ4),
PLZ4 = ifelse(AGS == 15090070, 3962, PLZ4),
PLZ3 = ifelse(AGS == 03159009, 371, PLZ3),
PLZ3 = ifelse(AGS == 03159018, 371, PLZ3),
PLZ3 = ifelse(AGS == 15090070, 396, PLZ3),
PLZ2 = ifelse(AGS == 03159009, 37, PLZ2),
PLZ2 = ifelse(AGS == 03159018, 37, PLZ2),
PLZ2 = ifelse(AGS == 15090070, 39, PLZ2),
PLZ1 = ifelse(AGS == 03159009, 3, PLZ1),
PLZ1 = ifelse(AGS == 03159018, 3, PLZ1),
PLZ1 = ifelse(AGS == 15090070, 3, PLZ1))
for (mykennziffer in c("PLZ2","PLZ3","PLZ4","PLZ5")) {
myname <-  paste0(mykennziffer)
mylabel<-  paste0(mykennziffer)
print(paste("Level:",myname,"Label:",mylabel))
# Datensatzerstellung
outputdata <- Resultdataset
outputdata <- outputdata %>% rename(gemeinde_id = Gemeindekennziffer, year = Jahr, gisd_score = GISD_Score)
outputdata <- outputdata %>% select(AGS=gemeinde_id,year,gisd_score)
outputdata <- left_join(as.data.frame(PLZ.df) %>% ungroup() %>% mutate(AGS=as.numeric(as.character(AGS))),
outputdata,by=c("AGS"), all.x = TRUE)
outputdata <- outputdata %>% mutate(AGS = as.character(AGS),
AGS = ifelse(nchar(AGS)<8,paste0("0",AGS),AGS))
outputdata <- outputdata %>% filter(!is.na(mykennziffer) & !is.na(EW_Area) & !is.na(year) & EW_Area>0)
mycol <- which(mykennziffer %in% names(outputdata))
outputdata <- outputdata %>% group_by(year,AGS)
outputdata <- outputdata %>% mutate(gisd_score = weighted.mean(gisd_score,EW_Area))
#names(outputdata)[names(outputdata)=="year"]<- "JAHR" # Seltsames Problem Name "Jahr"
outputdata <- outputdata %>% group_by_at(vars("year",mykennziffer)) %>%
summarise(gisd_score = weighted.mean(gisd_score,EW_Area), population = sum(EW_Area)) %>%
group_by(year)
outputdata <- outputdata %>%  mutate(gisd_score = round((gisd_score -min(gisd_score ))/(max(gisd_score )-min(gisd_score)), digits=6),
gisd_5 = findInterval(gisd_score, quantile(gisd_score,   probs=0:5/5 , type=9)),
gisd_5 = findInterval(gisd_5, c(1:5)),
gisd_10 = findInterval(gisd_score, quantile(gisd_score, probs=0:10/10 , type=9)),
gisd_10 = findInterval(gisd_10, c(1:10)),
gisd_k = findInterval(gisd_5, c(1,2,5)))
summary(outputdata)
head(outputdata)
ListeJahre <- unique(outputdata$year)
dir.create( paste0("Outfiles"), showWarnings=F)
dir.create( paste0("Outfiles/2022_v03"), showWarnings=F)
dir.create( paste0("Outfiles/2022_v03/Bund/"), showWarnings=F)
mydata <- outputdata %>% ungroup()
write.csv(mydata, paste0("Outfiles/2022_v03/Bund/GISD_Bund_",mylabel,".csv"), row.names=FALSE, fileEncoding="UTF-8")
mydata <- outputdata %>% ungroup()
names(mydata) <- gsub("\\.","_",make.names(names(mydata)))
names(mydata) <- gsub("\\?","oe",names(mydata))
names(mydata) <- gsub("\\?","ae",names(mydata))
names(mydata) <- gsub("\\?","ue",names(mydata))
names(mydata) <- gsub("\\?","ss",names(mydata))
write_dta(mydata, paste0("Outfiles/2022_v03/Bund/GISD_Bund_",mylabel,"_long.dta"))
}
# Output Postcode Data
load("Data/SHP/GEM_Zipcode_Intersections_2015.RData")
PLZ <- PLZ.df %>%
ungroup()
PLZ <- PLZ %>%
mutate(AGS = ifelse(GEN == "Dransfeld", as.numeric(as.character(03159009)), as.numeric(as.character(AGS))),
AGS = ifelse(GEN == "Hattorf", as.numeric(as.character(03159018)), as.numeric(as.character(AGS))),
AGS = ifelse(GEN == "Göttingen", as.numeric(as.character(03159016)), as.numeric(as.character(AGS)))) %>%
add_row(AGS = as.numeric(as.character(6412000)), GEN = "Frankfurt am Main", EWZ = 732688, EW_Area = 0,
PLZ5 = 60312,
PLZ4 = 6031,
PLZ3 = 603,
PLZ2 = 60,
PLZ1 = 6) %>%
add_row(AGS = as.numeric(as.character(16070029)), GEN = "Ilmenau", EWZ = 26153, EW_Area = 7028,
PLZ5 = 98694,
PLZ4 = 9869,
PLZ3 = 986,
PLZ2 = 98,
PLZ1 = 9) %>%
add_row(AGS = as.numeric(as.character(16070057)), GEN = "Geratal", EWZ = 4523, EW_Area = 4523,
PLZ5 = 99331,
PLZ4 = 9933,
PLZ3 = 993,
PLZ2 = 99,
PLZ1 = 9) %>%
mutate(PLZ5 = ifelse(AGS == 03159009, 37127, PLZ5),
PLZ5 = ifelse(AGS == 03159018, 37197,PLZ5),
PLZ5 = ifelse(AGS == 15090070, 39628,PLZ5),
PLZ4 = ifelse(AGS == 03159009, 3712, PLZ4),
PLZ4 = ifelse(AGS == 03159018, 3719, PLZ4),
PLZ4 = ifelse(AGS == 15090070, 3962, PLZ4),
PLZ3 = ifelse(AGS == 03159009, 371, PLZ3),
PLZ3 = ifelse(AGS == 03159018, 371, PLZ3),
PLZ3 = ifelse(AGS == 15090070, 396, PLZ3),
PLZ2 = ifelse(AGS == 03159009, 37, PLZ2),
PLZ2 = ifelse(AGS == 03159018, 37, PLZ2),
PLZ2 = ifelse(AGS == 15090070, 39, PLZ2),
PLZ1 = ifelse(AGS == 03159009, 3, PLZ1),
PLZ1 = ifelse(AGS == 03159018, 3, PLZ1),
PLZ1 = ifelse(AGS == 15090070, 3, PLZ1))
for (mykennziffer in c("PLZ2","PLZ3","PLZ4","PLZ5")) {
myname <-  paste0(mykennziffer)
mylabel<-  paste0(mykennziffer)
print(paste("Level:",myname,"Label:",mylabel))
# Datensatzerstellung
outputdata <- Resultdataset
outputdata <- outputdata %>% rename(gemeinde_id = Gemeindekennziffer, year = Jahr, gisd_score = GISD_Score)
outputdata <- outputdata %>% select(AGS=gemeinde_id,year,gisd_score)
outputdata <- left_join(as.data.frame(PLZ) %>% ungroup() %>% mutate(AGS=as.numeric(as.character(AGS))),
outputdata,by=c("AGS"), all.x = TRUE)
outputdata <- outputdata %>% mutate(AGS = as.character(AGS),
AGS = ifelse(nchar(AGS)<8,paste0("0",AGS),AGS))
outputdata <- outputdata %>% filter(!is.na(mykennziffer) & !is.na(EW_Area) & !is.na(year) & EW_Area>0)
mycol <- which(mykennziffer %in% names(outputdata))
outputdata <- outputdata %>% group_by(year,AGS)
outputdata <- outputdata %>% mutate(gisd_score = weighted.mean(gisd_score,EW_Area))
#names(outputdata)[names(outputdata)=="year"]<- "JAHR" # Seltsames Problem Name "Jahr"
outputdata <- outputdata %>% group_by_at(vars("year",mykennziffer)) %>%
summarise(gisd_score = weighted.mean(gisd_score,EW_Area), population = sum(EW_Area)) %>%
group_by(year)
outputdata <- outputdata %>%  mutate(gisd_score = round((gisd_score -min(gisd_score ))/(max(gisd_score )-min(gisd_score)), digits=6),
gisd_5 = findInterval(gisd_score, quantile(gisd_score,   probs=0:5/5 , type=9)),
gisd_5 = findInterval(gisd_5, c(1:5)),
gisd_10 = findInterval(gisd_score, quantile(gisd_score, probs=0:10/10 , type=9)),
gisd_10 = findInterval(gisd_10, c(1:10)),
gisd_k = findInterval(gisd_5, c(1,2,5)))
summary(outputdata)
head(outputdata)
ListeJahre <- unique(outputdata$year)
dir.create( paste0("Outfiles"), showWarnings=F)
dir.create( paste0("Outfiles/2022_v03"), showWarnings=F)
dir.create( paste0("Outfiles/2022_v03/Bund/"), showWarnings=F)
mydata <- outputdata %>% ungroup()
write.csv(mydata, paste0("Outfiles/2022_v03/Bund/GISD_Bund_",mylabel,".csv"), row.names=FALSE, fileEncoding="UTF-8")
mydata <- outputdata %>% ungroup()
names(mydata) <- gsub("\\.","_",make.names(names(mydata)))
names(mydata) <- gsub("\\?","oe",names(mydata))
names(mydata) <- gsub("\\?","ae",names(mydata))
names(mydata) <- gsub("\\?","ue",names(mydata))
names(mydata) <- gsub("\\?","ss",names(mydata))
write_dta(mydata, paste0("Outfiles/2022_v03/Bund/GISD_Bund_",mylabel,"_long.dta"))
}
DAT <- read.csv("C:7git_projects7GISD7Outfiles72022_v037Bund7GISD_Bund_PLZ5.csv")
DAT <- read.csv("C:7git_projects7GISD7Outfiles/2022_v03/Bund/GISD_Bund_PLZ5.csv")
DAT <- read.csv("C:/git_projects/GISD/Outfiles/2022_v03/Bund/GISD_Bund_PLZ5.csv")
View(DAT)
View(DAT)
DAT <- DAT %>%
filter(PLZ5 == 37073 |
PLZ5 == 37075 |
PLZ5 == 37077 |
PLZ5 == 37079 |
PLZ5 == 37081 |
PLZ5 == 37083 |
PLZ5 == 37085 |
PLZ5 == 37127 |
PLZ5 == 37197 |
PLZ5 == 39628 |
PLZ5 == 98694 |
PLZ5 == 99331)
write.csv(DAT, "S:/OE/FG28/205 Regionale Unterschiede/GISD/Anfragen zum GISD/Geißler_2023/PLZ5_Anfrage.csv")
write.csv(DAT, "S:/OE/FG28/205 Regionale Unterschiede/GISD/Anfragen zum GISD/Geißler_2023/PLZ5_Anfrage.csv")
